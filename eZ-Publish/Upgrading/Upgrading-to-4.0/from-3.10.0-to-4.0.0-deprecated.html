<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


<style type="text/css">
    @import url(../../../extension/ezdoc/design/doc/stylesheets/core.css);
    @import url(../../../extension/ezdoc/design/doc/stylesheets/classes.css);
    @import url(../../../extension/ezdoc/design/doc/stylesheets/doc.css);
    @import url(../../../extension/ezdoc/design/doc/stylesheets/print.css) print;</style>

<link type="text/css" rel="stylesheet" href="../../../extension/ezdoc/design/doc/stylesheets/print.css" media="print">

<!-- IE conditional comments; for bug fixes for different IE versions -->
<!--[if IE 5]>     <style type="text/css"> @import url(/extension/ezdoc/design/doc/stylesheets/ie5.css);    </style>     <![endif]-->
<!--[if lte IE 6]> <style type="text/css"> @import url(/extension/ezdoc/design/doc/stylesheets/ie6lte.css); </style>     <![endif]-->
<!--[if lte IE 6]> <style type="text/css"> @import url(/extension/ezdoc/design/doc/stylesheets/ie6lte-doc.css); </style> <![endif]-->
<!--[if IE 6]>     <style type="text/css"> @import url(/extension/ezdoc/design/doc/stylesheets/ie6.css);    </style>     <![endif]-->

<!-- Load special stylesheet (if necessary) for newer Netscape decendants, Mozilla and Firefox, using the Gecko renderer -->
<script type="text/javascript"><!-- if ((navigator.userAgent.indexOf("Gecko") != -1)&&(navigator.userAgent.indexOf("KHTML") == -1)) document.write("<style type=\"text/css\">@import url(/extension/ezdoc/design/doc/stylesheets/gecko.css);</style>"); --></script>

<script type="text/javascript" src="../../../extension/ezdoc/design/doc/javascripts/mainmenu-hover.js"></script>
<script type="text/javascript" src="../../../extension/ezdoc/design/doc/javascripts/dropdownmenu.js"></script>
<script type="text/javascript" src="../../../extension/ezdoc/design/doc/javascripts/ezno-searchbox.js"></script>
                                        
    <title>from 3.10.0 to 4.0.0 (deprecated) / Upgrading to 4.0 / Upgrading / eZ Publish / Documentation - Doc</title>

    
    
    
            <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

            <meta http-equiv="Content-language" content="en-GB">

    
                <meta name="author" content="eZ systems">
                    <meta name="copyright" content="eZ systems">
                    <meta name="description" content="eZ Publish Documentation">
                    <meta name="keywords" content="eZ Publish, documentation, manual, reference, eZ systems">
        
    <meta name="generator" content="eZ Publish">
    <link rel="Home" href="https://doc.ez.no/" title="Doc front page">
<link rel="Search" href="https://doc.ez.no/content/advancedsearch" title="Search Doc">
<link rel="Shortcut icon" href="../../../extension/ezdoc/design/doc/images/favicon.ico" type="image/x-icon">

</head>
<body onload="initDocSearch();menuInit();">

<!-- Complete page area: START -->
<div id="page">


<div><a href="https://www.ibexa.co"><img class="logotype" width="100" height="50" src="https://ezpublishdoc.mugo.ca/design/standard/images/ibexa_logo.svg" alt="ibexa"></a></div>
<div id="page-content-position"><div id="page-content-position-inner"><div id="page-content">

<!-- Path area: START -->
<div id="path">

<div id="page-width4">
<h2 class="hide">Path</h2>

<!-- Path content: START -->
<p><a href="../index.html">ez publish</a>
        
                        /
                            <a href="../../Upgrading.html">upgrading</a>
        
                        /
                            <a href="../Upgrading-to-4.0.html">upgrading to 4.0</a>
        
                        /
                            from 3.10.0 to 4.0.0 (depre...
        
            </p>
<!-- Path content: END -->

</div>

</div>
<!-- Path area: END -->

<hr class="hide">

<!-- Main area: START -->
                                    <div id="ezp5disclaimer">
                <p><strong style="color: red">Caution:</strong> This documentation is for <strong>eZ Publish</strong> <em>legacy</em>, from version 3.x to 5.x.<br></p>
            </div>
            
<div id="page-width5">
<div id="main" class="float-break">


<div class="template-design area-docmenu-normal">
<div class="template-module">
<div class="template-object">
<div id="contentmenu">
                        <div class="attribute-heading"><h2 class="bullet"><a href="../Upgrading-to-4.0.html">Table of contents</a></h2></div>
<div class="boxcontent">

<map id="contentstructure">

    

                                                                        
            <ul>
	    
                                                        
                                    
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Releases.html" title="">
	    	    		                    		    <span class="node-name-normal">Releases</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../How-to-proceed.html" title="">
	    	    		                    		    <span class="node-name-normal">How to proceed</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Backup-and-consistency-checks.html" title="">
	    	    		                    		    <span class="node-name-normal">Backup and consistency checks</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Direct-upgrading.html" title="">
	    	    		                    		    <span class="node-name-normal">Direct upgrading</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-5.1.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 5.1</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-5.0.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 5.0</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-4.7.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 4.7</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-4.6.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 4.6</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-4.5.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 4.5</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-4.4.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 4.4</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-4.3.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 4.3</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-4.2.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 4.2</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-4.1.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 4.1</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter-selected  ">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-4.0.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 4.0</span>
                    			    	    		</a>
			           </div>
        
            <ul>
	    
                                                    
	<li>
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="Important-notes.html" title="">
	    	    		                    		    <span class="node-name-normal">Important notes</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li>
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="from-4.0.x-to-4.0.y.html" title="">
	    	    		                    		    <span class="node-name-normal">from 4.0.x to 4.0.y</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li>
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="from-3.10.x-to-4.0.y.html" title="">
	    	    		                    		    <span class="node-name-normal">from 3.10.x to 4.0.y</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="currentnode">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="from-3.10.0-to-4.0.0-deprecated.html" title="">
	    	    		                    		    <span class="node-name-normal">from 3.10.0 to 4.0.0 (deprecated)</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="last">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="from-4.0.0-to-4.0.1rc2-deprecated.html" title="">
	    	    		                    		    <span class="node-name-normal">from 4.0.0 to 4.0.1rc2 (deprecated)</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                            </ul>
                                        </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-3.10.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 3.10</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-3.9.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 3.9</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-3.8.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 3.8</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-3.7.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 3.7</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-3.6.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 3.6</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-3.5.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 3.5</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-3.4.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 3.4</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-3.3.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 3.3</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-3.2.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 3.2</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-3.1.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 3.1</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-3.0.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 3.0</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-from-3.a.b-to-3.x.y.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading from 3.a.b to 3.x.y</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../The-system-upgrade-scripts.html" title="">
	    	    		                    		    <span class="node-name-normal">The system upgrade scripts</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Notes-about-database-changes.html" title="">
	    	    		                    		    <span class="node-name-normal">Notes about database changes</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                            </ul>
                        
            
</map>

</div>            
</div>
</div>
</div>
</div>
<div class="area-docmain-normal">
<div class="template-design">
<div class="template-module content-view-full">
<div class="template-object">

<div class="attribute-heading">
<h1>from 3.10.0 to 4.0.0 (deprecated)</h1>
</div>

 <p>This documentation page is deprecated and no longer maintained. Refer to the following documentation pages for upgrade instructions:</p>
<ul>
 <li><div> <a href="from-3.10.x-to-4.0.y.html" target="_self">Upgrading from 3.10.x to 4.0.y</a>  </div></li> <li><div> <a href="from-4.0.x-to-4.0.y.html" target="_self">Upgrading from 4.0.x to 4.0.y</a>  </div></li> 
</ul>
 <p>This section describes how to upgrade your existing eZ Publish 3.10.0 installation to version 4.0.0. If you are upgrading from a version prior to eZ Publish 3.10.0, you need to first <a href="../Upgrading-to-3.10/from-3.9.x-to-3.10.0-deprecated.html" target="_self">upgrade to 3.10.0</a> before you can upgrade to 4.0.0. In this case, there are two system upgrade scripts that you should skip running when upgrading from 3.9.x to 3.10.0:</p>
<ul>
 <li><div> In eZ Publish 4.0, the "bin/php/updateniceurls.php" script was sufficiently improved. In addition, the support for <a href="../../Technical-manual/4.x/Features/Multi-language-support-for-URL-aliases.html#wildcard_based_url_forwarding" target="_self">wildcard based URL forwarding</a> was re-added and the default type of URL transformation was changed to "urlalias". Refer to <a href="http://issues.ez.no/11650" target="_blank">http://issues.ez.no/11650</a> and <a href="http://issues.ez.no/12093" target="_blank">http://issues.ez.no/12093</a> for more information. </div></li> <li><div> The "updatetipafriendpolicy.php" upgrade script in eZ Publish 3.10.0 contains a bug. It prevents the script from granting access to the "Tip a friend" feature to users. The problem occurs when the script is run on Windows. This issue was fixed in 4.0.0 (plus the upcoming versions 3.10.1 and 3.9.5). Refer to <a href="http://issues.ez.no/11663" target="_blank">http://issues.ez.no/11663</a> for more information. </div></li> 
</ul>
  <a name="eztoc85574_1" id="eztoc85574_1"></a><h2>How to upgrade</h2> <p>Note that in some cases, it is not possible or not recommended to upgrade from version 3.10.0 to 4.0.0. Read the "<a href="Important-notes.html" target="_self">Important notes</a>" section in order to find out whether you can upgrade immediately or have to delay upgrading until new software releases are available.</p> <p>The upgrade procedure described below is generic and does not cover any specific cases (for example, running eZ Publish in a clustered environment).</p> <p>eZ Publish 4.0 contains all the functionality of the 3.10 series. Before upgrading, check the <a href="../../Technical-manual/4.x/Installation/Normal-installation/Requirements-for-doing-a-normal-installation.html" target="_self">requirements</a> and set up the hosting environment for your site accordingly, so that you can quickly switch to PHP 5 after upgrading the distribution files.</p> <p>Make sure that you have a working <a href="../../Upgrading.html#backup" target="_self">backup</a> of the site before you do the actual upgrade. The upgrade procedure consists of the following steps: </p> 
<ol>
 <li><div> Upgrading the distribution files to 4.0 </div></li> <li><div> Upgrading the database to 4.0 </div></li> <li><div> Running the 4.0 upgrade scripts </div></li> <li><div> Updating the system configuration </div></li> <li><div> Clearing the caches </div></li> 
</ol>
  <a name="eztoc85574_1_1" id="eztoc85574_1_1"></a><h3>Step 1: Upgrading the distribution files</h3> <p>The easiest way to upgrade the distribution files is to unpack eZ Publish 4.0 to a directory and then copy the directories that contain site-specific files from the existing installation. Make sure that you copy the following directories: </p> 
<ul>
 <li><div> design/example </div></li> <li><div> design/example_admin </div></li> <li><div> var </div></li> <li><div> settings/siteaccess </div></li> <li><div> settings/override </div></li> 
</ul>
 <p>Replace "example" and "example_admin" with actual names used by your siteaccesses.</p>  <a name="eztoc85574_1_1_1" id="eztoc85574_1_1_1"></a><h4>Custom extensions</h4> <p>If you are using custom extensions, the subdirectories inside the "extension" directory will also have to be copied. However, make sure that you do not overwrite any extensions that come with eZ Publish (currently "ezodf" and "ezdhtml").</p> <p>If you are using the <a href="https://doc.ez.no/Extensions/eZ-Publish-extensions/Website-Interface" target="_self">Website Interface</a> front-end, you will need to upgrade the extension to version 1.3 as earlier versions are not compatible with eZ Publish 4. Refer to the "Upgrading the Website Interface" chapter of the <a href="https://doc.ez.no/Extensions/eZ-Publish-extensions/Website-Interface#download" target="_self">Website Interface installation guide</a> for more information and instructions.</p>   <a name="eztoc85574_1_1_2" id="eztoc85574_1_1_2"></a><h4> Switching to PHP 5</h4> <p>After upgrading the distribution files, switch your site to use PHP 5 (make sure all the <a href="../../Technical-manual/4.x/Installation/Normal-installation/Requirements-for-doing-a-normal-installation.html" target="_self">requirements</a> are met).</p> <p>
 <a name="timezone"></a>
 <br>Note that you need to set the "<a href="http://www.php.net/manual/en/ref.datetime.php#ini.date.timezone" target="_blank">date.timezone</a>" value in the "php.ini" configuration file. If this setting is not specified, you will most likely receive error messages like "It is not safe to rely on the system's timezone settings" when running eZ Publish on PHP 5. The following example shows how the corresponding line in "php.ini" looks like:</p> <pre class="wordwrap"><span class="line">date.timezone = &lt;timezone&gt;</span>
</pre> <p>Refer to the <a href="http://www.php.net/timezones" target="_blank">PHP documentation</a> for the list of supported timezones. Don't forget to restart Apache after editing "php.ini". </p>    <a name="eztoc85574_1_2" id="eztoc85574_1_2"></a><h3>Step 2: Upgrading the database</h3> <p>The following text describes how a 3.10.0 database can be upgraded to 4.0.0.</p>  <a name="eztoc85574_1_2_3" id="eztoc85574_1_2_3"></a><h4>MySQL</h4> 
<ol>
 <li><div> Navigate into the eZ Publish 4.0.0 directory. </div></li> <li><div> 
Run the database upgrade script: <br> <pre class="wordwrap"><span class="line">mysql -u &lt;username&gt; -p&lt;password&gt; &lt;database&gt; &lt;</span>
<span class="line">update/database/mysql/4.0/dbupdate-3.10.0-to-4.0.0.sql</span>
</pre>  </div></li> 
</ol>
 <p>
Note that the CREATE TABLE statements in the database upgrade script do not specify which storage engine to use (no ENGINE or TYPE option), and thus the default storage engine will be used. Normally, it is MyISAM. If you are using InnoDB, make sure the default storage engine is set to InnoDB before you run the database upgrade script (refer to the <a href="http://dev.mysql.com/doc/refman/5.0/en/storage-engines.html" target="_blank">MySQL documentation</a> for information about how to set the default engine). If you were not able to change the MySQL configuration on your server, and the upgrade left you with a mix of table types, you can convert the newly created table to InnoDB using the following SQL query:<br></p><pre class="wordwrap"><span class="line">ALTER TABLE ezurlwildcard TYPE = innodb;</span>
</pre><p> </p> <p>It is also possible to use the "bin/php/ezconvertmysqltabletype.php" script for database conversion.</p>   <a name="eztoc85574_1_2_4" id="eztoc85574_1_2_4"></a><h4>PostgreSQL</h4> 
<ol>
 <li><div> Navigate into the eZ Publish 4.0.0 directory. </div></li> <li><div> 
Run the database upgrade script:<br> <pre class="wordwrap"><span class="line">psql -d &lt;database&gt; -U &lt;dbowner&gt; &lt; update/database/postgresql/4.0/dbupdate-3.10.0-to-4.0.0.sql</span>
</pre>  </div></li> 
</ol>
    <a name="eztoc85574_1_3" id="eztoc85574_1_3"></a><h3>Step 3: Running the system upgrade scripts</h3> <p> <a name="updatebinaryfile"></a>
 </p>  <a name="eztoc85574_1_3_5" id="eztoc85574_1_3_5"></a><h4>Binary files uploaded via WebDAV (optional)</h4> <p>In eZ Publish version 3.9.0 - 3.9.4 and 3.10.0, there is a bug in the "<a href="../../Technical-manual/4.x/Reference/Datatypes/File.html" target="_self">File</a>" datatype which may cause problems with binary file uploading via WebDAV. The typical symptoms are that the file extension of the uploaded file is missing and that you may not be able to download the file once it is uploaded (refer to <a href="http://issues.ez.no/9450" target="_blank">http://issues.ez.no/9450</a> for more information). This issue was fixed in eZ Publish 4.0.0.</p> <p>If your site has objects that were created by uploading files via WebDAV and you have configured <a href="../../Technical-manual/4.x/Features/WebDAV.html#mapping_mime_types" target="_self">MIME-type-to-class mapping</a> using the "MimeClassMap[]" directive in an override for "upload.ini", you need to run the "updatebinaryfile.php" script in order to fix the file extensions. (If a content class does not have any attributes that make use of the "File" datatype, instances of this class are not affected.) This script should be run for all siteaccesses that use different databases. If you only have a public and an administration siteaccess (which is the most typical/usual case), you only need to run the script for one of the siteaccesses. If the siteaccess isn't specified, the <a href="../../Technical-manual/4.x/Reference/Configuration-files/site.ini/SiteSettings/DefaultAccess.html" target="_self">default siteaccess</a> will be used. </p> <p>The following example shows how to run the script. </p>
<ol>
 <li><div> Navigate into the eZ Publish 4.0 directory. </div></li> <li><div> 
Run the script (replace "example" with the actual name of your siteaccess): <br> <pre class="wordwrap"><span class="line">php update/common/scripts/4.0/updatebinaryfile.php -s example</span>
</pre>  </div></li> 
</ol>
 <p>The script will go through all the binary files and fix their extensions. The filename entries stored in the "ezbinaryfile" database table will be changed accordingly.</p>   <a name="eztoc85574_1_3_6" id="eztoc85574_1_3_6"></a><h4>Multi-language support for URL aliases (optional)</h4> <p>eZ Publish 4.0 supports wildcard based URL forwarding. This feature was removed when implementing the multilingual URLs functionality for eZ Publish 3.10.0 and then re-added in later versions. In eZ Publish 4.0, the upgrade script for generating multilingual URL aliases was sufficiently improved. In addition, the default type of URL transformation was changed to "urlalias" (refer to <a href="http://issues.ez.no/12093" target="_blank">http://issues.ez.no/12093</a> for more information).</p> <p>If you are upgrading from 3.9.x to 4.0.0, you need to upgrade to 3.10.0 first and then upgrade to 4.0.0. In this case, it is recommended to skip running the "updateniceurls.php" script when upgrading to 3.10.0, and run the updated version of the script when upgrading from 3.10.0 to 4.0.0.</p> <p>If you are running eZ Publish 3.10.0 and experiencing any problems with multilingual URL aliases, these can be a result of changes that were made by the "updateniceurls.php" script when upgrading to 3.10.0. In order to avoid such problems in the future, it is recommended to revert the changes and run the updated version of the script when upgrading from 3.10.0 to 4.0.0. However, this operation is not safe: in case you have added new custom URL aliases in 3.10.0, these will be lost.</p>  <a name="eztoc85574_1_3_6_1" id="eztoc85574_1_3_6_1"></a><h5>Reverting the changes</h5> <p>In order to revert the changes that were made by the "updateniceurls.php" script when upgrading to 3.10.0, run the following SQL queries: </p> <pre class="wordwrap"><span class="line">UPDATE ezurlalias SET is_imported=0;</span>
<span class="line">TRUNCATE ezurlalias_ml;</span>
</pre>   <a name="eztoc85574_1_3_6_2" id="eztoc85574_1_3_6_2"></a><h5>Running the upgrade script</h5> <p>After reverting the changes, you need to run the upgrade script once again. This procedure is described in the "<a href="../Upgrading-to-3.10/from-3.9.x-to-3.10.0-deprecated.html#updateniceurls" target="_self">Multi-language support for URL aliases</a>" section of the 3.10.0 upgrade documentation. However, there are two differences for eZ Publish 4.0:</p> 
<ol>
 <li><div> The default value of "<a href="../../Technical-manual/4.x/Reference/Configuration-files/site.ini/URLTranslator/TransformationGroup.html" target="_self">TransformationGroup</a>" setting was changed in eZ Publish 4.0 from "urlalias_iri" to "urlalias". </div></li> <li><div> 
In eZ Publish 4.0, the script supports some new parameters, and thus you need to use the following shell command to run the script:<br> <pre class="wordwrap"><span class="line">php bin/php/updateniceurls.php --import --fetch-limit=number -s example</span>
</pre>Replace "example" with the actual name of the siteaccess and specify the desired number of items to handle per one iteration instead of "number"; the script will automatically do as many iterations as necessary to convert all the URLs, based on the number specified. </div></li> 
</ol>
 <p>The "--import" parameter makes the script go through all entries in the "ezurlalias" database table, which was used for storing URL aliases in eZ Publish 3.9 and earlier versions. As a result, old URL aliases will be imported to the new system and stored in the "ezurlalias_ml" table. This database table is used for storing multilingual URL aliases in eZ Publish 3.10.0 and later versions.</p> <p>If the optional "--fetch-limit" parameter is omitted, the script will handle 200 items per one iteration. </p>    <a name="eztoc85574_1_3_7" id="eztoc85574_1_3_7"></a><h4>Changes to roles and policies (optional)</h4> <p>If you are running eZ Publish on Windows, note that in eZ Publish 3.10.0 there is a bug in the "updatetipafriendpolicy.php" script that prevents it from granting access to the "Tip a friend" feature to the users. The same bug exists in eZ Publish 3.9.4 and earlier versions (refer to <a href="http://issues.ez.no/11663" target="_blank">http://issues.ez.no/11663</a> for more information). The updated version of the "updatetipafriendpolicy.php" script is available in eZ Publish 4.0.0 (plus the upcoming versions 3.10.1 and 3.9.5). Windows users are encouraged to re-run this script when upgrading from 3.10.0 to 4.0. The following example shows how this can be done:</p> 
<ol>
 <li><div> Navigate into the eZ Publish 4.0.0 directory. </div></li> <li><div> 
Run the script using the following shell command:<br> <pre class="wordwrap"><span class="line">php update/common/scripts/4.0/updatetipafriendpolicy.php -s example_admin -l login -p password</span>
</pre>  </div></li> 
</ol>
 <p>Replace "example_admin" with the actual name of your admin siteaccess and use the administrator's login and password instead of "login" and "password".</p> <p>The script will add a new role that grants access to the "Tip a friend" feature and ask for confirmation about assigning this role to each user or user group located one level beneath the "Users" top level node.</p>   <a name="eztoc85574_1_3_8" id="eztoc85574_1_3_8"></a><h4>Improved handling of country dependent VATs (optional)</h4> <p>The "updatevatcountries.php" upgrade script in eZ Publish 3.10.0 contains a bug. The same bug exists in eZ Publish 3.9.4 and 3.9.3 (refer to <a href="http://issues.ez.no/11955" target="_blank">http://issues.ez.no/11955</a> for more information). The updated version of the script is available for download and will be included in the upcoming eZ Publish 4.0.1, 3.10.1 and 3.9.5 releases. If you upgraded to 3.10.0 using the original version of the script, you need to download the updated version from <a href="https://github.com/ezsystems/ezpublish-legacy/blob/master/update/common/scripts/4.0/updatevatcountries.php" target="_blank">http://pubsvn.ez.no</a> and run it when upgrading from 3.10.0 to 4.0.0. </p> <p>This script should be run once for each database, specifying one siteaccess per database. If you only have a public and an administration siteaccess that share the same database (which is the most typical/usual case), you only need to run the script for one of the siteaccesses. If the siteaccess isn't specified, the <a href="../../Technical-manual/4.x/Reference/Configuration-files/site.ini/SiteSettings/DefaultAccess.html" target="_self">default siteaccess</a> will be used.</p> <p>The following example shows how to run the script: </p> 
<ol>
 <li><div> Navigate into the eZ Publish 4.0.0 directory. </div></li> <li><div> 
Run the "updatevatcountries.php" script (replace "example" with the actual name of your siteaccess):<br> <pre class="wordwrap"><span class="line">php update/common/scripts/4.0/updatevatcountries.php -s example</span>
</pre>  </div></li> 
</ol>
 <p>The script will go through all the VAT rules in the database and update them.</p>    <a name="eztoc85574_1_4" id="eztoc85574_1_4"></a><h3>Step 4: Updating the system configuration</h3>  <a name="eztoc85574_1_4_9" id="eztoc85574_1_4_9"></a><h4>Custom/override templates location</h4> <p>In eZ Publish versions prior to 4.0.0, the order of design resources used by the "<a href="../../Technical-manual/4.x/Reference/Template-operators/URLs/ezdesign.html" target="_self">ezdesign</a>" and "<a href="../../Technical-manual/4.x/Reference/Template-operators/URLs/ezimage.html" target="_self">ezimage</a>" template operators was not the same as used by the "<a href="../../Technical-manual/4.x/Reference/Template-functions/Miscellaneous/include.html" target="_self">include</a>" template function and eZTemplate::fetch(). This might lead to problems with overriding templates in extensions (refer to <a href="http://issues.ez.no/9595" target="_blank">http://issues.ez.no/9595</a> for more information). This issue was fixed in eZ Publish 4.0.0.</p> <p>In eZ Publish 4.0, templates that override default ones must be placed in the "override/templates" directory of your design. If you are not sure about the location of override templates in your eZ Publish installation, review the settings in your "override.ini.append.php" configuration file. (Refer to "<a href="../../Technical-manual/4.x/Templates/The-template-override-system.html" target="_self">The template override system</a>" for more information.) The names of the override templates are specified using the "MatchFile" directive, which makes it possible to find the corresponding files on a filesystem.</p> <p>Note that custom templates that are not connected with the override system must be placed in the "templates" directory of a custom design.</p>   <a name="eztoc85574_1_4_10" id="eztoc85574_1_4_10"></a><h4>Outgoing mail delivery</h4> <p>In eZ Publish 4.0.0 there is a bug in the "ezsmtp" class that prevents the system from sending outgoing mails through an SMTP server. This bug will be fixed in the upcoming eZ Publish 4.0.1 release. If your site uses an SMTP relay server for mail delivery, you need to either <a href="../../Technical-manual/4.x/Reference/Configuration-files/site.ini/MailSettings/Transport.html" target="_self">switch to sendmail</a> (if available) or <a href="https://github.com/ezsystems/ezpublish-legacy/blob/master/lib/ezutils/classes/ezsmtptransport.php" target="_blank">download the updated version of the "ezsmtp" class</a> and replace the corresponding file in your eZ Publish installation. </p>    <a name="eztoc85574_1_5" id="eztoc85574_1_5"></a><h3>Step 5: Clearing the caches</h3> <p>Whenever an eZ Publish solution is upgraded, all caches must be cleared in a proper way. This should be done from within a system shell:</p> 
<ol>
 <li><div> Navigate into the eZ Publish 4.0 directory. </div></li> <li><div> 
Run the script using the following shell command:<br> <pre class="wordwrap"><span class="line">php bin/php/ezcache.php --clear-all --purge</span>
</pre>  </div></li> 
</ol>
 <p>Purging ensures that the caches are physically removed. Without the "--purge" option, the caches will be expired but not removed.</p> <p>Sometimes the script is unable to clear all cache files because of restrictive file/directory permission settings. Make sure that all cache files have been cleared by inspecting the contents of the various cache subdirectories within the "var" directory (typically "var/cache/" and "var/&lt;name_of_siteaccess&gt;/cache/" directories). If there are any cache files left, you need to remove them manually.</p>  

<div class="break"></div><div class="pageinfo float-break">
<div class="created">


<p><label>Written by:</label>Julia Shymova (05/11/2007 3:52 pm)</p>
</div>
<div class="modified">
<p><label>Last updated by:</label>Svitlana Shatokhina (24/10/2008 8:12 am)</p>
</div><div class="authors">
<p><label>Maintainers:</label>Svitlana Shatokhina, Julia Shymova</p>
</div></div>
<hr class="hide">

</div>
</div>
</div>

<div id="comments" class="class-comment">
<div class="content-view-children">

<h1>Comments</h1>
<div id="comments-content">
<ul>    <li class="comment-bglight"><div class="padding">
    <div class="content-view-line">
<div class="class-comment">

<div>

<div id="comment19771" class="attribute-heading">
<h2>Problem with update</h2>
</div>

<div class="attribute-byline float-break">
    <p class="date">Thursday 10 January 2008 7:24:35 am</p>
    <p class="author">Angelika</p>
</div>

<div class="attribute-short">
HI! I have done the update from 3.10.0 to 4.0 on a Linux system.<br>
<br>
It works quite well even with the old Website Interface V 1.2. BUT:<br>
<br>
If I try the update from V 1.2 to V 1.3 I got the error message:<br>
<br>
ws-buero:/srv/www/edvberatung # php ezwebinupgrade.php (my website)<br>
<br>
#!/usr/bin/env php<br>
PHP Fatal error:  Cannot redeclare __autoload() (previously declared in /srv/www/edvberatung/autoload.php:29) in /srv/www/edvberatung/autoload.php on line 47<br>
<br>
Thanks for help<br>
Angelika
</div>




     


</div>

<ul>    <li class="comment-bglight"><div class="padding">
    <div class="content-view-line">
<div class="class-comment">

<div>

<div id="comment20222" class="attribute-heading">
<h2>Re: Problem with update</h2>
</div>

<div class="attribute-byline float-break">
    <p class="date">Friday 30 May 2008 11:39:56 am</p>
    <p class="author">Svitlana Shatokhina</p>
</div>

<div class="attribute-short">
Note for 4.0.0 users: before upgrading Website Interface to v1.3, you need to download <a href="http://pubsvn.ez.no/nextgen/stable/4.0/bin/php/ezwebincommon.php" title="http://pubsvn.ez.no/nextgen/stable/4.0/bin/php/ezwebincommon.php">http://pubsvn.ez.no/nextgen/stable/4.0/bin/php/ezwebincommon.php</a> and replace "bin/php/ezwebincommon.php" in your installation (refer to the Wesite Interface setup guide and <a href="http://issues.ez.no/12371" title="http://issues.ez.no/12371">http://issues.ez.no/12371</a> for more information).
</div>




     


</div>


</div>
</div>    </div></li></ul>
</div>
</div>    </div></li>    <li class="comment-bgdark"><div class="padding">
    <div class="content-view-line">
<div class="class-comment">

<div>

<div id="comment20235" class="attribute-heading">
<h2>It is not possible to update when you are using pathprefix</h2>
</div>

<div class="attribute-byline float-break">
    <p class="date">Tuesday 10 June 2008 8:00:00 pm</p>
    <p class="author">John</p>
</div>

<div class="attribute-short">
Hi,<br>
<br>
I have checked all possibility to update from ez 3.10 to 4.0<br>
When you are using the pathprefix, correctly updete is not possible :(
</div>




     


</div>

<ul>    <li class="comment-bglight"><div class="padding">
    <div class="content-view-line">
<div class="class-comment">

<div>

<div id="comment20236" class="attribute-heading">
<h2>Re: It is not possible to update when you are using pathprefix</h2>
</div>

<div class="attribute-byline float-break">
    <p class="date">Wednesday 11 June 2008 8:56:05 am</p>
    <p class="author">Svitlana Shatokhina</p>
</div>

<div class="attribute-short">
Hi, please read the following pages:<br>
<a href="http://ez.no/doc/ez_publish/technical_manual/4_0/reference/configuration_files/site_ini/siteaccesssettings/pathprefix" title="http://ez.no/doc/ez_publish/technical_manual/4_0/reference/configuration_files/site_ini/siteaccesssettings/pathprefix">http://ez.no/doc/ez_publish/techn...te_ini/siteaccesssettings/pathprefix</a><br>
<a href="http://ez.no/doc/ez_publish/technical_manual/4_0/reference/configuration_files/site_ini/siteaccesssettings/pathprefixexclude" title="http://ez.no/doc/ez_publish/technical_manual/4_0/reference/configuration_files/site_ini/siteaccesssettings/pathprefixexclude">http://ez.no/doc/ez_publish/techn...siteaccesssettings/pathprefixexclude</a><br>
and the "Updating INI settings that use URL aliases" subsection here:<br>
<a href="http://ez.no/doc/ez_publish/upgrading/upgrading_to_3_10/from_3_9_x_to_3_10_0" title="http://ez.no/doc/ez_publish/upgrading/upgrading_to_3_10/from_3_9_x_to_3_10_0">http://ez.no/doc/ez_publish/upgra...grading_to_3_10/from_3_9_x_to_3_10_0</a><br>
Hopefully you'll find the answer there. Thanks!<br>
<br>

</div>




     


</div>


</div>
</div>    </div></li></ul>
</div>
</div>    </div></li>    <li class="comment-bglight"><div class="padding">
    <div class="content-view-line">
<div class="class-comment">

<div>

<div id="comment20238" class="attribute-heading">
<h2>page content not showing in edit box</h2>
</div>

<div class="attribute-byline float-break">
    <p class="date">Friday 13 June 2008 3:50:09 pm</p>
    <p class="author">Matteo</p>
</div>

<div class="attribute-short">
Hi, I just completed a long overdue upgrade from 3.7.3 to 4.0.  I went through all the intermediate upgrade steps, as I was supposed to (3.7 to 3.8, 3.8 to 3.9, etc.).  <br>
<br>
It looks fine and works well, except for one thing:  when I go to edit a page in the admin interface, the current content of that page doesn't show up.  Anything that I type into the edit box overwrites the old content.  Is there a setting I need to change somewhere so that the current content of pages will show up in the edit box?  <br>
<br>
Thanks!
</div>




     


</div>

<ul>    <li class="comment-bglight"><div class="padding">
    <div class="content-view-line">
<div class="class-comment">

<div>

<div id="comment20243" class="attribute-heading">
<h2>Re: page content not showing in edit box</h2>
</div>

<div class="attribute-byline float-break">
    <p class="date">Thursday 26 June 2008 9:29:27 am</p>
    <p class="author">Svitlana Shatokhina</p>
</div>

<div class="attribute-short">
Hi, looks like that's this bug: <a href="http://issues.ez.no/12493" title="http://issues.ez.no/12493">http://issues.ez.no/12493</a> (will be fixed in 4.0.1).
</div>




     


</div>


</div>
</div>    </div></li></ul>
</div>
</div>    </div></li>    <li class="comment-bgdark"><div class="padding">
    <div class="content-view-line">
<div class="class-comment">

<div>

<div id="comment20263" class="attribute-heading">
<h2>broken urls</h2>
</div>

<div class="attribute-byline float-break">
    <p class="date">Monday 07 July 2008 1:49:55 pm</p>
    <p class="author">hli</p>
</div>

<div class="attribute-short">
While upgrading we wanted to change the url separator from underscore to dash, but after running updateniceurls most of the links did not work anymore and produced "Module not found" errors. The backend (admin access) worked nevertheless.<br>
The only working setting for TransformationGroup was 'urlalias_compat' which produced the old urls with underscores... Any help appreciated.<br>

</div>




     


</div>

<ul>    <li class="comment-bglight"><div class="padding">
    <div class="content-view-line">
<div class="class-comment">

<div>

<div id="comment20298" class="attribute-heading">
<h2>Re: broken urls</h2>
</div>

<div class="attribute-byline float-break">
    <p class="date">Tuesday 12 August 2008 1:06:33 pm</p>
    <p class="author">Ole Marius Smestad</p>
</div>

<div class="attribute-short">
Hi,<br>
<br>
in order to give you feedback here, we would need some more information about the installation and steps you did during the upgrade. Could you please open a bug-report or a forum post, adding some of the details of the server environment, like eZ Publish and PHP version, character set used for the site, and also which command options you used.<br>
<br>
Have you tried with the the upgrade process with the latest release, 4.0.1rc2?
</div>




     


</div>


</div>
</div>    </div></li></ul>
</div>
</div>    </div></li></ul>
</div>
<div class="toolbar">


</div>

</div>
</div>

</div>
<!-- Main area content: END -->

</div>
</div>
<!-- Main area: END -->
<hr class="hide">

</div></div></div>



</div>
<!-- Complete page area: END -->











</body>
</html><!-- th[eZ] 20050804 -->
