<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


<style type="text/css">
    @import url(../../../extension/ezdoc/design/doc/stylesheets/core.css);
    @import url(../../../extension/ezdoc/design/doc/stylesheets/classes.css);
    @import url(../../../extension/ezdoc/design/doc/stylesheets/doc.css);
    @import url(../../../extension/ezdoc/design/doc/stylesheets/print.css) print;</style>

<link type="text/css" rel="stylesheet" href="../../../extension/ezdoc/design/doc/stylesheets/print.css" media="print">

<!-- IE conditional comments; for bug fixes for different IE versions -->
<!--[if IE 5]>     <style type="text/css"> @import url(/extension/ezdoc/design/doc/stylesheets/ie5.css);    </style>     <![endif]-->
<!--[if lte IE 6]> <style type="text/css"> @import url(/extension/ezdoc/design/doc/stylesheets/ie6lte.css); </style>     <![endif]-->
<!--[if lte IE 6]> <style type="text/css"> @import url(/extension/ezdoc/design/doc/stylesheets/ie6lte-doc.css); </style> <![endif]-->
<!--[if IE 6]>     <style type="text/css"> @import url(/extension/ezdoc/design/doc/stylesheets/ie6.css);    </style>     <![endif]-->

<!-- Load special stylesheet (if necessary) for newer Netscape decendants, Mozilla and Firefox, using the Gecko renderer -->
<script type="text/javascript"><!-- if ((navigator.userAgent.indexOf("Gecko") != -1)&&(navigator.userAgent.indexOf("KHTML") == -1)) document.write("<style type=\"text/css\">@import url(/extension/ezdoc/design/doc/stylesheets/gecko.css);</style>"); --></script>

<script type="text/javascript" src="../../../extension/ezdoc/design/doc/javascripts/mainmenu-hover.js"></script>
<script type="text/javascript" src="../../../extension/ezdoc/design/doc/javascripts/dropdownmenu.js"></script>
<script type="text/javascript" src="../../../extension/ezdoc/design/doc/javascripts/ezno-searchbox.js"></script>
                                        
    <title>from 4.0.x to 4.0.y / Upgrading to 4.0 / Upgrading / eZ Publish / Documentation - Doc</title>

    
    
    
            <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

            <meta http-equiv="Content-language" content="en-GB">

    
                <meta name="author" content="eZ systems">
                    <meta name="copyright" content="eZ systems">
                    <meta name="description" content="eZ Publish Documentation">
                    <meta name="keywords" content="eZ Publish, documentation, manual, reference, eZ systems">
        
    <meta name="generator" content="eZ Publish">
    <link rel="Home" href="https://doc.ez.no/" title="Doc front page">
<link rel="Search" href="https://doc.ez.no/content/advancedsearch" title="Search Doc">
<link rel="Shortcut icon" href="../../../extension/ezdoc/design/doc/images/favicon.ico" type="image/x-icon">

</head>
<body onload="initDocSearch();menuInit();">

<!-- Complete page area: START -->
<div id="page">


<div><a href="https://www.ibexa.co"><img class="logotype" width="100" height="50" src="https://ezpublishdoc.mugo.ca/design/standard/images/ibexa_logo.svg" alt="ibexa"></a></div>
<div id="page-content-position"><div id="page-content-position-inner"><div id="page-content">

<!-- Path area: START -->
<div id="path">

<div id="page-width4">
<h2 class="hide">Path</h2>

<!-- Path content: START -->
<p><a href="../index.html">ez publish</a>
        
                        /
                            <a href="../../Upgrading.html">upgrading</a>
        
                        /
                            <a href="../Upgrading-to-4.0.html">upgrading to 4.0</a>
        
                        /
                            from 4.0.x to 4.0.y
        
            </p>
<!-- Path content: END -->

</div>

</div>
<!-- Path area: END -->

<hr class="hide">

<!-- Main area: START -->
                                    <div id="ezp5disclaimer">
                <p><strong style="color: red">Caution:</strong> This documentation is for <strong>eZ Publish</strong> <em>legacy</em>, from version 3.x to 5.x.<br></p>
            </div>
            
<div id="page-width5">
<div id="main" class="float-break">


<div class="template-design area-docmenu-normal">
<div class="template-module">
<div class="template-object">
<div id="contentmenu">
                        <div class="attribute-heading"><h2 class="bullet"><a href="../Upgrading-to-4.0.html">Table of contents</a></h2></div>
<div class="boxcontent">

<map id="contentstructure">

    

                                                                        
            <ul>
	    
                                                        
                                    
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Releases.html" title="">
	    	    		                    		    <span class="node-name-normal">Releases</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../How-to-proceed.html" title="">
	    	    		                    		    <span class="node-name-normal">How to proceed</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Backup-and-consistency-checks.html" title="">
	    	    		                    		    <span class="node-name-normal">Backup and consistency checks</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Direct-upgrading.html" title="">
	    	    		                    		    <span class="node-name-normal">Direct upgrading</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-5.1.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 5.1</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-5.0.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 5.0</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-4.7.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 4.7</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-4.6.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 4.6</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-4.5.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 4.5</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-4.4.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 4.4</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-4.3.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 4.3</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-4.2.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 4.2</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-4.1.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 4.1</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter-selected  ">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-4.0.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 4.0</span>
                    			    	    		</a>
			           </div>
        
            <ul>
	    
                                                    
	<li>
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="Important-notes.html" title="">
	    	    		                    		    <span class="node-name-normal">Important notes</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="currentnode">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="from-4.0.x-to-4.0.y.html" title="">
	    	    		                    		    <span class="node-name-normal">from 4.0.x to 4.0.y</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li>
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="from-3.10.x-to-4.0.y.html" title="">
	    	    		                    		    <span class="node-name-normal">from 3.10.x to 4.0.y</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li>
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="from-3.10.0-to-4.0.0-deprecated.html" title="">
	    	    		                    		    <span class="node-name-normal">from 3.10.0 to 4.0.0 (deprecated)</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="last">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="from-4.0.0-to-4.0.1rc2-deprecated.html" title="">
	    	    		                    		    <span class="node-name-normal">from 4.0.0 to 4.0.1rc2 (deprecated)</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                            </ul>
                                        </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-3.10.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 3.10</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-3.9.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 3.9</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-3.8.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 3.8</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-3.7.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 3.7</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-3.6.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 3.6</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-3.5.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 3.5</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-3.4.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 3.4</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-3.3.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 3.3</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-3.2.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 3.2</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-3.1.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 3.1</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-3.0.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 3.0</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-from-3.a.b-to-3.x.y.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading from 3.a.b to 3.x.y</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../The-system-upgrade-scripts.html" title="">
	    	    		                    		    <span class="node-name-normal">The system upgrade scripts</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Notes-about-database-changes.html" title="">
	    	    		                    		    <span class="node-name-normal">Notes about database changes</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                            </ul>
                        
            
</map>

</div>            
</div>
</div>
</div>
</div>
<div class="area-docmain-normal">
<div class="template-design">
<div class="template-module content-view-full">
<div class="template-object">

<div class="attribute-heading">
<h1>from 4.0.x to 4.0.y</h1>
</div>

 <p>This section describes how to upgrade your existing eZ Publish 4.0.x installation to version 4.0.y. If you are upgrading from a version prior to eZ Publish 4.0.0, refer to the "<a href="from-3.10.x-to-4.0.y.html" target="_self">Upgrading from 3.10.x to 4.0.y</a>" section for upgrade instructions.</p> <p>In order to benefit from the latest bug fixes, you should upgrade directly to the latest stable release in the 4.0 branch (4.0.1 at the time of writing). Refer to the <a href="https://github.com/ezsystems/ezpublish-legacy/tree/master/doc/changelogs/4.0" target="_blank">changelogs</a> and <a href="http://ez.no/developer/security/security_advisories/ez_publish_4_0" target="_blank">security advisories</a> for more information about the issues that were fixed in the latest releases.</p> <p>Make sure that you have a working <a href="../../Upgrading.html#backup" target="_self">backup</a> of the site before you do the actual upgrade. The upgrade procedure consists of the following steps:</p> 
<ol>
 <li><div> Upgrading the distribution files to 4.0.1 </div></li> <li><div> Upgrading the database to 4.0.1 </div></li> <li><div> Running the system upgrade scripts </div></li> <li><div> Updating the system configuration </div></li> <li><div> Clearing the caches </div></li> 
</ol>
  <a name="eztoc98307_1" id="eztoc98307_1"></a><h2>Step 1: Upgrading the distribution files</h2> <p>The easiest way to upgrade the distribution files is to unpack eZ Publish 4.0.1 to a separate directory and then copy the directories that contain site-specific files from the existing installation. Make sure that you copy the following directories: </p> 
<ul>
 <li><div> design/example </div></li> <li><div> design/example_admin </div></li> <li><div> var </div></li> <li><div> settings/siteaccess </div></li> <li><div> settings/override </div></li> 
</ul>
 <p>Replace "example" and "example_admin" with the actual names of your siteaccesses.</p>  <a name="eztoc98307_1_1" id="eztoc98307_1_1"></a><h3>Custom extensions</h3> <p>If you are using custom extensions, the subdirectories inside the "extension" directory will also have to be copied. However, make sure that you do not overwrite any extensions that come with eZ Publish (currently "ezdhtml", "ezodf" and "ezurlaliasmigration"). Note that upgrading the distribution files will overwrite the <a href="Important-notes.html#autoload" target="_self">autoload arrays</a> for extensions. You will need to re-generate the autoload arrays for active extensions later (after enabling the "ezurlaliasmigration" extension in step 3).</p> <p>If you are using the <a href="https://doc.ez.no/Extensions/eZ-Publish-extensions/Website-Interface" target="_self">Website Interface</a> front-end, be sure to copy the "extension/ezwebin/" directory.</p>   <a name="eztoc98307_1_2" id="eztoc98307_1_2"></a><h3>Important bug fix for remote IDs</h3> <p>Due to some bugs in previous versions of eZ Publish (3.9.0 and others), it might happen that not all content objects in your database have unique <a href="../../Technical-manual/4.x/Reference/Objects/ezcontentobject.html#remote_id" target="_self">remote IDs</a>. This basically means that the "remote_id" column of the "ezcontentobject" table in the database might contain duplicate values. In eZ Publish 4.0.1, a database schema change was introduced in order to ensure that only unique remote IDs can be stored in this table. Because of this, you need to make sure that there are no content objects with identical remote IDs before upgrading the database. This can be done by running the "fixobjectremoteid.php" upgrade script. (Note that both the database schema change and the upgrade script were added to eZ Publish 3.9.5 and 3.10.1 as well.) </p> <p>This script should be run once for each database, specifying one siteaccess per database. If you only have a public and an administration siteaccess that share the same database (which is the most typical/usual case), you only need to run the script for one of the siteaccesses. If the siteaccess isn't specified, the <a href="../../Technical-manual/4.x/Reference/Configuration-files/site.ini/SiteSettings/DefaultAccess.html" target="_self">default siteaccess</a> will be used. </p> <p>The following example shows how to run the script:</p> 
<ol>
 <li><div> Navigate into the eZ Publish 4.0.1 directory. </div></li> <li><div> <p>Run the script (replace "example" with the actual name of your siteaccess):</p> <pre class="wordwrap"><span class="line">php update/common/scripts/4.0/fixobjectremoteid.php -s example</span>
</pre> </div></li> 
</ol>
 <p>The script will search for objects with non-unique remote IDs. Every time such an object is found, the script will suggest to either display more detailed information or fix the problem automatically. If you choose the first option, the script will display the list of objects that have the same remote ID and let you decide which one should remain unchanged; all other objects in the list will get new remote IDs. Otherwise, the script will fix the problem automatically based on the objects' creation dates. This means that the script will generate new remote IDs for all objects in the list except the one that was created first.</p> <p>The optional "--mode" parameter makes it possible to run the script in either "auto-fix" or "manual-fix" mode as shown below.</p> <pre class="wordwrap"><span class="line">php update/common/scripts/4.0/fixobjectremoteid.php -s example --mode=value</span>
</pre> <p>If you replace "value" with "a" in the command above, the script will automatically fix all non-unique remote IDs that are found in the database based on the objects' creation dates. In this case, no further input is required from the user. If you specify "--mode=d", the script will display the list of objects for each non-unique remote ID so that you can manually choose which objects should keep their remote IDs.</p>    <a name="eztoc98307_2" id="eztoc98307_2"></a><h2>Step 2: Upgrading the database</h2> <p>Follow the instructions below to upgrade your eZ Publish database from version 4.0.0 to 4.0.1.</p>  <a name="eztoc98307_2_3" id="eztoc98307_2_3"></a><h3>Switching to InnoDB (MySQL only)</h3> <p>If you are using MySQL, note that the <a href="../../Technical-manual/4.x/Installation/Normal-installation/Requirements-for-doing-a-normal-installation.html#innodb" target="_self">recommended storage engine is InnoDB</a>. This storage engine is used by default during the installation process when the setup wizard initializes the database structure for eZ Publish. In addition, InnoDB will most likely be required for future versions of eZ Publish to run on MySQL. Contact your database administrator if you are unsure about whether InnoDB is available on your server.</p> <p>In the future, all database upgrade scripts will use the InnoDB storage engine when creating new tables. Because of this, it is recommended (but not required) to make sure that all existing tables in your database use InnoDB. If you want to use the MyISAM (or another) storage engine instead, all existing tables in your database must use this engine.</p> <p>You can use the "bin/php/ezconvertmysqltabletype.php" script to find out about the current storage engine in your database and convert your tables to use another engine if needed (refer to the "<a href="from-3.10.x-to-4.0.y.html#ezconvertmysqltabletype" target="_self">Switching to InnoDB</a>" part of the "Upgrading from 3.10.x to 4.0.y" documentation page for more information about this script).</p>   <a name="eztoc98307_2_4" id="eztoc98307_2_4"></a><h3>Running the database upgrade scripts</h3> <p>The following text describes how to run the database upgrade scripts. (Note that even though the sql file contains a section marked with "from 3.10.1" comments, you do not need to skip this part when upgrading from 4.0.0 to 4.0.1.)</p>  <a name="eztoc98307_2_4_1" id="eztoc98307_2_4_1"></a><h4>MySQL</h4> 
<ol>
 <li><div> Navigate into the eZ Publish 4.0.1 directory. </div></li> <li><div> 
Run the database upgrade script: <br> <pre class="wordwrap"><span class="line">mysql -u &lt;username&gt; -p&lt;password&gt; &lt;database&gt; &lt; update/database/mysql/4.0/dbupdate-4.0.0-to-4.0.1.sql</span>
</pre>  </div></li> 
</ol>
   <a name="eztoc98307_2_4_2" id="eztoc98307_2_4_2"></a><h4>PostgreSQL</h4> 
<ol>
 <li><div> Navigate into the eZ Publish 4.0.1 directory. </div></li> <li><div> 
Run the database upgrade script: <br> <pre class="wordwrap"><span class="line">psql -d &lt;database&gt; -U &lt;dbowner&gt; &lt; update/database/postgresql/4.0/dbupdate-4.0.0-to-4.0.1.sql</span>
</pre>  </div></li> 
</ol>
 <p>Specific steps for upgrading to versions 4.0.2 until 4.0.7 are located <a href="from-4.0.x-to-4.0.y.html#Upgrading" target="_self">here</a>.</p>     <a name="eztoc98307_3" id="eztoc98307_3"></a><h2>Step 3: Running the system upgrade scripts</h2> <p>The 4.0.1 version of eZ Publish introduces a couple of important bug fixes and functionality changes. In order to make sure that your site is compatible with these changes, you may need to run a few upgrade scripts.</p>  <a name="eztoc98307_3_5" id="eztoc98307_3_5"></a><h3>Multi-language support for URL aliases</h3> <p>In eZ Publish 4.0.1, the <a href="../../Technical-manual/4.x/Features/Multi-language-support-for-URL-aliases.html" target="_self">multi-language support for URL aliases</a> was substantially improved, along with some important bug fixes related to this functionality. When upgrading, you need to regenerate all URL aliases that are stored in the "ezurlalias_ml" database table. This basically means that all <a href="../../Technical-manual/4.x/Features/Multi-language-support-for-URL-aliases.html#auto" target="_self">auto-generated URL aliases</a> will be deleted and then created from scratch by using the "updateniceurls.php" script. However, <a href="../../Technical-manual/4.x/Features/Multi-language-support-for-URL-aliases.html#manual" target="_self">manual/user-defined URL aliases</a> and <a href="../../Technical-manual/4.x/Features/Multi-language-support-for-URL-aliases.html#history" target="_self">URL history entries</a> cannot be regenerated automatically. Instead, these items will be transfered/migrated into a temporary table in the database (hereinafter called "migration table") and then restored at a later stage. This must be done by using the "migrate.php" script, which is included in the "ezurlaliasmigration" extension. This new extension is included in eZ Publish 4.0.1 and provides tools for the purpose of URL alias migration.</p> <p>Follow the instructions below in order to update your URL aliases.</p>  <a name="eztoc98307_3_5_3" id="eztoc98307_3_5_3"></a><h4>1. Create a database backup.</h4> <p>Before you continue, create a backup of your database (or at least make sure that you have a backup of the "ezurlalias_ml" table itself).</p>   <a name="eztoc98307_3_5_4" id="eztoc98307_3_5_4"></a><h4>2. Enable the "ezurlaliasmigration" extension.</h4> <p>The "ezurlaliasmigration" extension must be enabled for all of your <a href="../../Technical-manual/4.x/Concepts-and-basics/Configuration/Site-management.html" target="_self">siteaccesses</a>. To do this, edit the "site.ini.append.php" file located in the "settings/override" directory and add the following line under the [ExtensionSettings] section:</p> <pre class="wordwrap"><span class="line">ActiveExtensions[]=ezurlaliasmigration</span>
</pre> <p>Alternatively, you can enable the extension separately for each siteaccess. To do this, edit the "site.ini.append.php" file located in the "settings/siteaccess/example" directory (replace "example" with the name of the target siteaccess) and add the following line under the [ExtensionSettings] section:</p> <pre class="wordwrap"><span class="line">ActiveAccessExtensions[]=ezurlaliasmigration</span>
</pre>   <a name="eztoc98307_3_5_5" id="eztoc98307_3_5_5"></a><h4>3. Update the autoload arrays for extensions (optional).</h4> <p>If you are using custom extensions, some of them might stop working after upgrading to 4.0.1. The reason for this is that the "autoload/ezp_extension.php" file is overwritten in the first step of the upgrade procedure (when upgrading the distribution files). To solve the problem, you need to regenerate the <a href="Important-notes.html#autoload" target="_self">autoload arrays</a> for active extensions as described below.</p> <p>Note that the default "autoload/ezp_extension.php" file in eZ Publih 4.0.1 contains all the information needed for the following extensions to work correctly: "ezdhtml", "ezodf", "ezurlaliasmigration", "ezflow" and "ezwebin". If you are only using these extensions (no custom ones), you do not have to regenerate the autoload arrays when upgrading to 4.0.1.</p> <p>The following example shows how to regenerate the autoload arrays for extensions.</p> 
<ol>
 <li><div> Navigate into the eZ Publish 4.0.1 directory. </div></li> <li><div> Run the script using the following shell command: <pre class="wordwrap"><span class="line">php bin/php/ezpgenerateautoloads.php --extension</span>
</pre>  </div></li> 
</ol>
 <p>The script will look for class definitions in the "extension" directory and update the "autoload/ezp_extension.php" file accordingly. </p> <p>Note that the command above makes the script go through all extensions regardless of whether or not they are enabled. You can also instruct the script to skip inactive extensions by listing them in the optional "--exclude" parameter (replace "ext1" and "ext2" with the actual names of the extension subdirectories):</p> <pre class="wordwrap"><span class="line">php bin/php/ezpgenerateautoloads.php --extension --exclude="extension/ext1 extension/ext2"</span>
</pre><p><a name="create_migration_table"></a>
 </p>   <a name="eztoc98307_3_5_6" id="eztoc98307_3_5_6"></a><h4>4. Create the migration table.</h4> <p>The "ezurlaliasmigration" extension requires a custom database table called "ezurlalias_ml_migrate" to be created in the database. This table will be used for storing the migrated URL alias data. The new table must be created in accordance with the definitions specified in the "schema.sql" file included in the extension. This can be done by executing the SQL queries from the "schema.sql" file as described below.</p> <p>If you are using MySQL, navigate into the eZ Publish 4.0.1 directory and run the following shell command:</p> <pre class="wordwrap"><span class="line">mysql -u &lt;username&gt; -p&lt;password&gt; &lt;database&gt; &lt; extension/ezurlaliasmigration/sql/mysql/schema.sql</span>
</pre> <p>
If you are running PostgreSQL, use the following shell command instead:<br></p><pre class="wordwrap"><span class="line">psql -d &lt;database&gt; -U &lt;dbowner&gt; &lt; extension/ezurlaliasmigration/sql/postgresql/schema.sql</span>
</pre><p> </p> <p>
Alternatively, you can use the "migrate.php" script to create the migration table. This option will work regardless of which database implementation you are using. You need to navigate into the eZ Publish 4.0.1 directory and run the script from within the system shell:<br></p><pre class="wordwrap"><span class="line">php extension/ezurlaliasmigration/scripts/migrate.php --create-migration-table</span>
</pre><p> </p> <p>With this command, the script will create the "ezurlalias_ml_migrate" table in the database that is used by the <a href="../../Technical-manual/4.x/Reference/Configuration-files/site.ini/SiteSettings/DefaultAccess.html" target="_self">default siteaccess</a>. If your site makes use of two or more databases, you need to run the script once for each database, specifying one siteaccess per database. Use the "-s" parameter to specify the target siteaccess as shown below:</p> <p> </p><pre class="wordwrap"><span class="line">php extension/ezurlaliasmigration/scripts/migrate.php -s example --create-migration-table</span>
</pre><p>
 <br>(Replace "example" with the actual name of your siteaccess.)</p>   <a name="eztoc98307_3_5_7" id="eztoc98307_3_5_7"></a><h4>5. Transfer your URL aliases to the migration table.</h4> <p>To find out about the current number of manual/user-defined URL aliases and URL history entries in your system, run the "migrate.php" script without parameters or with the "-s" parameter only. The following example shows how this can be done.</p> 
<ol>
 <li><div> Navigate into the eZ Publish 4.0.1 directory. </div></li> <li><div> Run the script (replace "example" with the actual name of your siteaccess): <pre class="wordwrap"><span class="line">php extension/ezurlaliasmigration/scripts/migrate.php -s example</span>
</pre>  </div></li> 
</ol>
 <p>Note that the commands for running the "migrate.php" and "updateniceurls.php" scripts in the examples below will assume that all your siteaccesses share the same database. Because of this, the "-s example" part will be omitted and the scripts will be run for the database that is used by the <a href="../../Technical-manual/4.x/Reference/Configuration-files/site.ini/SiteSettings/DefaultAccess.html" target="_self">default siteaccess</a>. If you are using two or more databases, the "migrate.php" script should be run once for each database, specifying one siteaccess per database (by adding the "-s" parameter to each command). This also applies to the "updateniceurls.php" script. Both scripts need to be run from the root directory of your eZ Publish 4.0.1 installation. The following table reveals the available parameters for the "migrate.php" script.</p> <table class="renderedtable" cellpadding="2" cellspacing="0">
 
<tr>
 <th>   <p>Parameter</p> 
  </th> <th>   <p>Description</p> 
  </th> 
</tr>
 
<tr>
 <td valign="top" style="vertical-align: top">   <p>--create-migration-table</p> 
  </td>
 <td valign="top" style="vertical-align: top">   <p>Create the migration table in the database.</p> 
  </td>
 
</tr>
 
<tr>
 <td valign="top" style="vertical-align: top">   <p>--migrate-alias</p> 
  </td>
 <td valign="top" style="vertical-align: top">   <p>Transfer manual URL aliases to the migration table.</p> 
  </td>
 
</tr>
 
<tr>
 <td valign="top" style="vertical-align: top">   <p>--migrate-history</p> 
  </td>
 <td valign="top" style="vertical-align: top">   <p>Transfer URL history entries to the migration table.</p> 
  </td>
 
</tr>
 
<tr>
 <td valign="top" style="vertical-align: top">   <p>--migrate</p> 
  </td>
 <td valign="top" style="vertical-align: top">   <p>Transfer both manual URL aliases and URL history entries to the migration table.</p> 
  </td>
 
</tr>
 
<tr>
 <td valign="top" style="vertical-align: top">   <p>--restore-alias</p> 
  </td>
 <td valign="top" style="vertical-align: top">   <p>Restore manual URL aliases from the migration table.</p> 
  </td>
 
</tr>
 
<tr>
 <td valign="top" style="vertical-align: top">   <p>--restore-history</p> 
  </td>
 <td valign="top" style="vertical-align: top">   <p>Restore URL history entries from the migration table.</p> 
  </td>
 
</tr>
 
<tr>
 <td valign="top" style="vertical-align: top">   <p>--restore</p> 
  </td>
 <td valign="top" style="vertical-align: top">   <p>Restore both manual URL aliases and URL history entries from the migration table.</p> 
  </td>
 
</tr>
 
</table>
 <p>To transfer your manual URL aliases and URL history entries into the migration table, run the "migrate.php" script as shown below:</p> <pre class="wordwrap"><span class="line">php extension/ezurlaliasmigration/scripts/migrate.php --migrate</span>
</pre> <p>The script will go through all manual URL aliases and URL history entries in the "ezurlalias_ml" table and put the collected data into the "ezurlalias_ml_migrate" table.</p> <p>Instead of transfering both manual URL aliases and URL history entries at once, it is also possible to run the script once for each type of URL entries. To do this, use either the "--migrate-alias" or "--migrate-history" parameter instead of "--migrate" when running the script (refer to the table above for more information about these parameters).</p> <p>It is important not to change any configuration settings after transfering the data to the migration table. The configuration of the URL alias system must remain untouched until you're finished with regenerating the URL aliases and transfering the data back to the "ezurlalias_ml" table (otherwise, there might be some broken or inconsistent URLs on your site after upgrading to 4.0.1).</p>   <a name="eztoc98307_3_5_8" id="eztoc98307_3_5_8"></a><h4>6. Remove old URL alias data.</h4> <p>Use the following SQL query to empty the "ezurlalias_ml" table in your database:</p> <pre class="wordwrap"><span class="line">TRUNCATE ezurlalias_ml;</span>
</pre>   <a name="eztoc98307_3_5_9" id="eztoc98307_3_5_9"></a><h4>7. Create new auto-generated URL aliases.</h4> <p>Now that the "ezurlalias_ml" table is empty, you need to create new auto-generated URL aliases based on the existing node tree structure and content object names. When you do this, it is recommended that you clear ini cache first, in order to avoid using old settings from cache (This can be done in the administration interface). Then run the "updateniceurls.php" script using the following command:</p> <pre class="wordwrap"><span class="line">php bin/php/updateniceurls.php --fetch-limit=number</span>
</pre> <p>Specify the desired number of items to handle per one iteration instead of "number". On a system with a 128 MB memory limit for PHP, this parameter can be set to 2000. (The script will automatically do as many iterations as necessary to generate the URL aliases for all nodes, based on the number specified. If the optional "--fetch-limit" parameter is omitted, the script will handle 200 items per one iteration.)</p> <p>The script will go through all content objects stored in the database and create new virtual URLs for them in accordance with the current transformation settings. New URL aliases will be generated for all of the <a href="../../Technical-manual/4.x/Features/Multi-language.html#translation_languages" target="_self">translation languages</a> and placed in the "ezurlalias_ml" table in the database.</p>   <a name="eztoc98307_3_5_10" id="eztoc98307_3_5_10"></a><h4>8. Restore migrated URL data.</h4> <p>You need to restore the custom URL aliases and URL history entries from the migration table. This can be done by running the "migrate.php" script:</p> <pre class="wordwrap"><span class="line">php extension/ezurlaliasmigration/scripts/migrate.php --restore</span>
</pre> <p>The script will go through all entries in the "ezurlalias_ml_migrate" table and put the collected data back into the "ezurlalias_ml" table. </p> <p>Instead of restoring both manual URL aliases and URL history entries at once, it is also possible to run the script once for each type of URL entries. To do this, use either the "--restore-alias" or "--restore-history" parameter instead of "--restore" when running the script (refer to the table above for more information about these parameters).</p> <p>It might happen that a URL alias entry was previously corrupted and cannot be automatically restored from the migration table. In this case, you will see "F" in the console output of the "migrate.php" script. The following SQL query can be used in order to display the migrated entries that were not restored:</p> <pre class="wordwrap"><span class="line">SELECT id, link, parent, lang_mask, text, action, is_original, is_alias, lang_mask_adjusted FROM ezurlalias_ml_migrate WHERE is_restored=0;</span>
</pre> <p>If you want the URL entries that were not restored automatically to work on your site, you must create new user-defined URLs later (when the upgrade procedure is finished). This can be done from within the administration interface as described on the "<a href="../../Technical-manual/4.x/Features/Multi-language-support-for-URL-aliases/Managing-URL-aliases.html" target="_self">Managing URL aliases</a>" documentation page.</p> <p>Specific steps regarding URL alias upgrade when upgrading to version 4.0.2 is located <a href="from-4.0.x-to-4.0.y.html#Upgrading" target="_self">here</a>.</p>    <a name="eztoc98307_3_6" id="eztoc98307_3_6"></a><h3>Changes to system upgrade scripts (optional)</h3> <p>If your solution was initially built on eZ Publish 3.10 or 4.0, skip this part. Otherwise, read it carefully.</p> <p>The "updatevatcountries.php" upgrade script in eZ Publish 3.10.0 contains a bug. The same bug exists in eZ Publish 3.9.3 and 3.9.4 (refer to <a href="http://issues.ez.no/11955" target="_blank">http://issues.ez.no/11955</a> for more information). The updated version of the script is available in eZ Publish 3.9.5, 3.10.1 and 4.0.1. If you previously upgraded to 3.10.0 using the original version of the script and then didn't run the updated version when upgrading from 3.10.0 to 4.0.0, you need to run it when upgrading to 4.0.1.</p> <p>This script should be run once for each database, specifying one siteaccess per database. If you only have a public and an administration siteaccess that share the same database (which is the most typical/usual case), you only need to run the script for one of the siteaccesses. If the siteaccess isn't specified, the <a href="../../Technical-manual/4.x/Reference/Configuration-files/site.ini/SiteSettings/DefaultAccess.html" target="_self">default siteaccess</a> will be used. </p> <p>The following example shows how to run the script: </p> 
<ol>
 <li><div> Navigate into the eZ Publish 4.0.1 directory. </div></li> <li><div> 
Run the script (replace "example" with the actual name of your siteaccess):<br> <pre class="wordwrap"><span class="line">php update/common/scripts/4.0/updatevatcountries.php -s example</span>
</pre>  </div></li> 
</ol>
 <p>The script will go through all the VAT rules in the database and update them.</p>    <a name="eztoc98307_4" id="eztoc98307_4"></a><h2>Step 4: Updating the system configuration</h2> <p>You are not required to do any configuration changes when upgrading from 4.0.x to 4.0.y. </p>  <a name="eztoc98307_4_7" id="eztoc98307_4_7"></a><h3>Tree menu configuration (optional)</h3> <p>eZ Publish 4.0.1 introduces some changes to the dynamic tree menu functionality. In particular, the "<a href="../../Technical-manual/4.x/Reference/Modules/content/Views/treemenu.html" target="_self">treemenu</a>" view of the "content" module no longer makes use of parameters that are transferred using GET variables (this improves tree menu compatibility when running PHP in <a href="http://en.wikipedia.org/wiki/Fastcgi" target="_blank">FastCGI</a> mode; refer to <a href="http://issues.ez.no/11806" target="_blank">http://issues.ez.no/11806</a> for more information).</p> <p>If you have instructed Apache to use "index_treemenu.php" instead of "index.php" when the treemenu view of the content module is requested, this feature will stop working after upgrading to version 4.0.1. To make it work, update your rewrite rules as described below.</p> <p>If your "<a href="http://en.wikipedia.org/wiki/.htaccess" target="_blank">.htaccess</a>" file contains the following line:</p> <pre class="wordwrap"><span class="line">RewriteRule content/treemenu/?$ index_treemenu.php</span>
</pre> <p>you need to remove "$" from there. The updated line should look like this:</p> <pre class="wordwrap"><span class="line">RewriteRule content/treemenu/? index_treemenu.php</span>
</pre> <p>If no ".htaccess" file is used, check whether the following line is present in your Apache configuration file:</p> <pre class="wordwrap"><span class="line">RewriteRule content/treemenu/?$ /index_treemenu.php [L]</span>
</pre> <p>If found, remove "$" from this line. The result will look like this:</p> <pre class="wordwrap"><span class="line">RewriteRule content/treemenu/? /index_treemenu.php [L]</span>
</pre> <p>Note that due to a bug in eZ Publish 4.0.1, you need to download the updated version of "index_treemenu.php" from <a href="https://github.com/ezsystems/ezpublish-legacy/blob/master/index_treemenu.php" target="_blank">http://pubsvn.ez.no</a> and replace the corresponding file in your installation. The same <a href="http://issues.ez.no/13528" target="_blank">bug</a> exists in eZ Publish 3.10.1.</p>    <a name="eztoc98307_5" id="eztoc98307_5"></a><h2>Step 5: Clearing the caches</h2> <p>Whenever an eZ Publish solution is upgraded, all caches must be cleared in a proper way. This should be done from within a system shell: </p> 
<ol>
 <li><div> Navigate into the eZ Publish 4.0.1 directory. </div></li> <li><div> 
Run the script using the following shell command:<br> <pre class="wordwrap"><span class="line">php bin/php/ezcache.php --clear-all --purge</span>
</pre>  </div></li> 
</ol>
 <p>Purging ensures that the caches are physically removed. When the "--purge" parameter is not specified, the caches will be expired but not removed (refer to <a href="../../Technical-manual/4.x/Reference/Scripts/Generic/ezcache.php.html" target="_self">this page</a> for more information).</p> <p>Sometimes the script is unable to clear all cache files because of restrictive file/directory permission settings. Make sure that all cache files have been cleared by inspecting the contents of the various cache subdirectories within the "var" directory (typically the "var/cache/" and "var/&lt;name_of_siteaccess&gt;/cache/" directories). If there are any cache files left, you need to remove them manually.</p>   <a name="eztoc98307_6" id="eztoc98307_6"></a><h2> <a name="Upgrading"></a>
Upgrading to 4.0.2</h2>   <a name="eztoc98307_6_7_11" id="eztoc98307_6_7_11"></a><h4>URL Alias upgrade</h4> <p>The 4.0.2 release expands on the work which was made to the URL alias system in 4.0.1. The fix to the URL alias system, changes the structure in which URL entries are stored. This means that the URL alias entries needs to be regenerated, as was the case when upgrading to 4.0.1. </p> <p>Follow the above upgrade steps to upgrade the URL aliases. With one important difference:</p> <p>In the last round of fixes made in this area, we discovered that it is unfortunately not possible to migrate the URL alias history entries. This is because they cannot be restored properly. This means that in the migration process, the <i>migrate.php</i> script should be run with the options to migrate aliases only (custom aliases are retained, as well as all future history elements). </p> <p>A simplified run down of the process below. Please advise with the full upgrade documentation for more detail. </p> 
<ul>
 <li><div> <p>Migrate custom URL aliases</p> <pre class="wordwrap"><span class="line">php extension/ezurlaliasmigration/scripts/migrate.php --migrate-alias</span>
</pre> </div></li> <li><div> <p>To clean up existing URL alias table, run this query: </p> <pre class="wordwrap"><span class="line">truncate ezurlalias_ml;</span>
</pre> </div></li> <li><div> <p>Regenerate URL alias entries for the site access <i>example</i>, replace with your own value </p> <pre class="wordwrap"><span class="line">bin/php/updateniceurls.php -s example --fetch-limit=number</span>
</pre> </div></li> <li><div> <p>Restore custom URL aliases </p> <pre class="wordwrap"><span class="line">php extension/ezurlaliasmigration/scripts/migrate.php --restore-alias</span>
</pre> </div></li> 
</ul>
     <a name="eztoc98307_6_7_12" id="eztoc98307_6_7_12"></a><h4>General upgrade scripts</h4> <p>First the database update queries need to be run. Then the upgrade scripts listed below, must be run. Use the <b>-h</b> parameter to see usage on how to run them. </p> 
<ul>
 <li><div>  <pre class="wordwrap"><span class="line">php update/common/scripts/4.0/initurlaliasmlid.php</span>
</pre>  </div></li> <li><div>  <pre class="wordwrap"><span class="line">php update/common/scripts/4.0/fixezurlobjectlinks.php</span>
</pre>  </div></li> <li><div>  <pre class="wordwrap"><span class="line">php update/common/scripts/4.0/fixclassremoteid.php</span>
</pre>  </div></li> 
</ul>
     <a name="eztoc98307_7" id="eztoc98307_7"></a><h2>Upgrading to 4.0.3</h2> <p>If you are not upgrading from eZ Publish 4.0.2, first make sure that the upgrade steps for 4.0.2 are performed, as listed above. For upgrading from eZ Publish 4.0.2 to eZ Publish 4.0.3, only the database queries in <i>dbupdate-4.0.2-to-4.0.3.sql</i> are required.</p>   <a name="eztoc98307_8" id="eztoc98307_8"></a><h2>Upgrading to 4.0.4</h2> <p>If you are not upgrading from eZ Publish 4.0.3, first make sure that the upgrade steps for 4.0.3 are performed, as listed above. For upgrading from eZ Publish 4.0.3 to eZ Publish 4.0.4, only the database queries in <i>dbupdate-4.0.3-to-4.0.4.sql</i> are required.</p>   <a name="eztoc98307_9" id="eztoc98307_9"></a><h2>Upgrading to 4.0.5</h2> <p>If you are not upgrading from eZ Publish 4.0.4, first make sure that the upgrade steps for 4.0.4 are performed, as listed above. For upgrading from eZ Publish 4.0.4 to eZ Publish 4.0.5, only the database queries in <i>dbupdate-4.0.4-to-4.0.5.sql</i> are required.</p>   <a name="eztoc98307_10" id="eztoc98307_10"></a><h2>Upgrading to 4.0.6</h2> <p>If you are not upgrading from eZ Publish 4.0.5, first make sure that the upgrade steps for 4.0.5 are performed, as listed above. For upgrading from eZ Publish 4.0.5 to eZ Publish 4.0.6, only the database queries in <i>dbupdate-4.0.5-to-4.0.6.sql</i> are required.</p>   <a name="eztoc98307_11" id="eztoc98307_11"></a><h2>Upgrading to 4.0.7</h2> <p>If you are not upgrading from eZ Publish 4.0.6, first make sure that the upgrade steps for 4.0.6 are performed, as listed above. For upgrading from eZ Publish 4.0.6 to eZ Publish 4.0.7, only the database queries in <i>dbupdate-4.0.6-to-4.0.7.sql</i> are required.</p> 

<div class="break"></div><div class="pageinfo float-break">
<div class="created">


<p><label>Written by:</label>Julia Shymova (22/05/2008 9:25 am)</p>
</div>
<div class="modified">
<p><label>Last updated by:</label>Ester Heylen (30/11/2009 9:11 am)</p>
</div><div class="authors">
<p><label>Maintainers:</label>Svitlana Shatokhina, Vidar Langseid, Ester Heylen</p>
</div></div>
<hr class="hide">

</div>
</div>
</div>

<div id="comments" class="class-comment">
<div class="content-view-children">

<h1>Comments</h1>
<div id="comments-content">
<ul>    <li class="comment-bglight"><div class="padding">
    <div class="content-view-line">
<div class="class-comment">

<div>

<div id="comment20440" class="attribute-heading">
<h2>Clear ini cache before running updateniceurls.php</h2>
</div>

<div class="attribute-byline float-break">
    <p class="date">Wednesday 05 November 2008 1:37:08 pm</p>
    <p class="author">Gurudutt Verma</p>
</div>

<div class="attribute-short">
Hi All,<br>
<br>
In "Step 3: Running the system upgrade scripts"  <br>
point  "7. Create new auto-generated URL aliases."<br>
<br>
It is recommended to clear ini cache first and then execute this script(updateniceurls.php) in order to avoide using old setting from cache.<br>
<br>
Also it's faster if execute "updateniceurls.php" script after clearing ini cache.<br>

</div>




     


</div>


</div>
</div>    </div></li>    <li class="comment-bgdark"><div class="padding">
    <div class="content-view-line">
<div class="class-comment">

<div>

<div id="comment20589" class="attribute-heading">
<h2>Way too complicated</h2>
</div>

<div class="attribute-byline float-break">
    <p class="date">Wednesday 13 May 2009 11:58:29 am</p>
    <p class="author">Gero Müller</p>
</div>

<div class="attribute-short">
Hi!<br>
<br>
The upgrade process of ezPublish is WAY too complicated. You should find a way to make it easier. Eg. seperate ezPublish-Source from user code, like TYPO3 does it. And at least document clearly which upgrade steps are needed for each version. Or better, create a upgrade script. Considering how important updates are regarding security the threshold for doing so is not acceptable.<br>
<br>
Kind regards<br>
Gero Müller
</div>




     


</div>

<ul>    <li class="comment-bglight"><div class="padding">
    <div class="content-view-line">
<div class="class-comment">

<div>

<div id="comment20606" class="attribute-heading">
<h2>Re: Way too complicated</h2>
</div>

<div class="attribute-byline float-break">
    <p class="date">Thursday 28 May 2009 1:22:16 am</p>
    <p class="author">Geoff Bentley</p>
</div>

<div class="attribute-short">
I agree with Gero - the time &amp; energy required to upgrade for a single project is off-putting.
</div>




     


</div>


</div>
</div>    </div></li>    <li class="comment-bgdark"><div class="padding">
    <div class="content-view-line">
<div class="class-comment">

<div>

<div id="comment20618" class="attribute-heading">
<h2>Re: Way too complicated</h2>
</div>

<div class="attribute-byline float-break">
    <p class="date">Friday 12 June 2009 6:29:36 pm</p>
    <p class="author">Christoph</p>
</div>

<div class="attribute-short">
I too fully agree with Gero.<br>
And there are so many if and when, that I really don't know what I have to do and what not.<br>
In fact as much as I like ez publish, as much I'm angry about this upgrading procedure.<br>
<br>
Ez needs urgently a separation between:<br>
<br>
- ez extensions and custom extension<br>
- extension settings and site-access settings (very partially availlable)<br>
- extension overrides to be placed in extension overrides and not in site-access: there should be only override rules specific to the site access!<br>
- For multi-domain management a domain settings override.<br>
<br>
Kind regards<br>
Christoph
</div>




     


</div>


</div>
</div>    </div></li>    <li class="comment-bglight"><div class="padding">
    <div class="content-view-line">
<div class="class-comment">

<div>

<div id="comment20620" class="attribute-heading">
<h2>Re: Way too complicated</h2>
</div>

<div class="attribute-byline float-break">
    <p class="date">Friday 12 June 2009 6:39:22 pm</p>
    <p class="author">Christoph</p>
</div>

<div class="attribute-short">
By the way:<br>
Is there a possibility that the index.php is placed in the webservers root directory but the file system in a subdirectory. This too would greatly simplify migration. But please not with symlinks. Not every provider gives shell access. And there are not too many hosting-partners in Switzerland.
</div>




     


</div>


</div>
</div>    </div></li>    <li class="comment-bgdark"><div class="padding">
    <div class="content-view-line">
<div class="class-comment">

<div>

<div id="comment20683" class="attribute-heading">
<h2>Re: Way too complicated</h2>
</div>

<div class="attribute-byline float-break">
    <p class="date">Monday 10 August 2009 7:04:32 am</p>
    <p class="author">Charly</p>
</div>

<div class="attribute-short">
Completly agree with you Gero. For now, an eZ publish upgrade needs to much time. High availibility is impossible for now.
</div>




     


</div>

<ul>    <li class="comment-bglight"><div class="padding">
    <div class="content-view-line">
<div class="class-comment">

<div>

<div id="comment21072" class="attribute-heading">
<h2>Re: Re: Way too complicated</h2>
</div>

<div class="attribute-byline float-break">
    <p class="date">Wednesday 04 November 2009 6:54:00 pm</p>
    <p class="author">Tofik Sahraoui</p>
</div>

<div class="attribute-short">
I also agree
</div>




     


</div>


</div>
</div>    </div></li></ul>
</div>
</div>    </div></li></ul>
</div>
</div>    </div></li>    <li class="comment-bglight"><div class="padding">
    <div class="content-view-line">
<div class="class-comment">

<div>

<div id="comment20609" class="attribute-heading">
<h2>upgrade to 4.03</h2>
</div>

<div class="attribute-byline float-break">
    <p class="date">Sunday 31 May 2009 2:57:24 pm</p>
    <p class="author">Erland Flaten</p>
</div>

<div class="attribute-short">
I want to upgrade a couple installations to 4.1.1 but before that I have to upgrade to 4.03 since what I have is 4.01. Is the description above also valid for upgrading to 4.03?
</div>




     


</div>

<ul>    <li class="comment-bglight"><div class="padding">
    <div class="content-view-line">
<div class="class-comment">

<div>

<div id="comment20621" class="attribute-heading">
<h2>Re: upgrade to 4.03</h2>
</div>

<div class="attribute-byline float-break">
    <p class="date">Friday 12 June 2009 6:44:22 pm</p>
    <p class="author">Christoph</p>
</div>

<div class="attribute-short">
Until proven wrong I'd say yes.<br>
But you have to run mysql upgrade successively from 4.0.1 to 4.0.2 and from 4.0.2 to 4.0.3.<br>
<br>
What is hinted but never really stated is, that you don't have to follow every step if your web site was originally build with ez prior to 4.0 or not. What is not mentioned at all is, what you can skip if the first installation was 4.0.1 or 4.0.2
</div>




     


</div>


</div>
</div>    </div></li></ul>
</div>
</div>    </div></li>    <li class="comment-bgdark"><div class="padding">
    <div class="content-view-line">
<div class="class-comment">

<div>

<div id="comment20623" class="attribute-heading">
<h2>Clustered env upgrade sql</h2>
</div>

<div class="attribute-byline float-break">
    <p class="date">Monday 15 June 2009 11:04:04 pm</p>
    <p class="author">Geoff Bentley</p>
</div>

<div class="attribute-short">
There is a change in the table structure of the cluster db tables in 4.0.3, so if upgrading to anything above this you'll need to run something like this:<br>
<br>
<pre class="wordwrap"><span class="line">ALTER TABLE ezdbfile</span>
<span class="line">	DROP INDEX ezdbfile_name,</span>
<span class="line">	DROP INDEX ezdbfile_expired_name;</span>
<span class="line"> </span>
<span class="line">ALTER TABLE ezdbfile MODIFY name TEXT NOT NULL,</span>
<span class="line">	ADD COLUMN name_trunk TEXT NOT NULL,</span>
<span class="line">	MODIFY expired BOOL NOT NULL DEFAULT '0',</span>
<span class="line">	ADD INDEX ezdbfile_name (name(250)),</span>
<span class="line">	ADD INDEX ezdbfile_expired_name (expired, name(250)),</span>
<span class="line">	ADD INDEX ezdbfile_name_trunk (name_trunk(250));</span>
<span class="line"> </span>
<span class="line">ALTER TABLE ezdbfile_data ADD CONSTRAINT ezdbfile_fk1 FOREIGN KEY (name_hash) REFERENCES ezdbfile (name_hash) ON DELETE CASCADE;</span>
</pre><br>
<br>
You can always 
</div>




     


</div>


</div>
</div>    </div></li>    <li class="comment-bglight"><div class="padding">
    <div class="content-view-line">
<div class="class-comment">

<div>

<div id="comment20664" class="attribute-heading">
<h2>Some other 4.0.x update scripts should be mentionned !!</h2>
</div>

<div class="attribute-byline float-break">
    <p class="date">Tuesday 21 July 2009 1:40:14 pm</p>
    <p class="author">rba</p>
</div>

<div class="attribute-short">
1) Script update/common/scripts/4.0/fixezurlobjectlinks.php introduced in 4.0.2 (see changelog or<br>
<a href="http://issues.ez.no/13492" title="http://issues.ez.no/13492">http://issues.ez.no/13492</a> )<br>
<br>
2) Script update/common/scripts/4.0/fixclassremoteid.php introduced in 4.0.2
</div>




     


</div>


</div>
</div>    </div></li></ul>
</div>
<div class="toolbar">


</div>

</div>
</div>

</div>
<!-- Main area content: END -->

</div>
</div>
<!-- Main area: END -->
<hr class="hide">

</div></div></div>



</div>
<!-- Complete page area: END -->











</body>
</html><!-- th[eZ] 20050804 -->
