<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


<style type="text/css">
    @import url(../../../extension/ezdoc/design/doc/stylesheets/core.css);
    @import url(../../../extension/ezdoc/design/doc/stylesheets/classes.css);
    @import url(../../../extension/ezdoc/design/doc/stylesheets/doc.css);
    @import url(../../../extension/ezdoc/design/doc/stylesheets/print.css) print;</style>

<link type="text/css" rel="stylesheet" href="../../../extension/ezdoc/design/doc/stylesheets/print.css" media="print">

<!-- IE conditional comments; for bug fixes for different IE versions -->
<!--[if IE 5]>     <style type="text/css"> @import url(/extension/ezdoc/design/doc/stylesheets/ie5.css);    </style>     <![endif]-->
<!--[if lte IE 6]> <style type="text/css"> @import url(/extension/ezdoc/design/doc/stylesheets/ie6lte.css); </style>     <![endif]-->
<!--[if lte IE 6]> <style type="text/css"> @import url(/extension/ezdoc/design/doc/stylesheets/ie6lte-doc.css); </style> <![endif]-->
<!--[if IE 6]>     <style type="text/css"> @import url(/extension/ezdoc/design/doc/stylesheets/ie6.css);    </style>     <![endif]-->

<!-- Load special stylesheet (if necessary) for newer Netscape decendants, Mozilla and Firefox, using the Gecko renderer -->
<script type="text/javascript"><!-- if ((navigator.userAgent.indexOf("Gecko") != -1)&&(navigator.userAgent.indexOf("KHTML") == -1)) document.write("<style type=\"text/css\">@import url(/extension/ezdoc/design/doc/stylesheets/gecko.css);</style>"); --></script>

<script type="text/javascript" src="../../../extension/ezdoc/design/doc/javascripts/mainmenu-hover.js"></script>
<script type="text/javascript" src="../../../extension/ezdoc/design/doc/javascripts/dropdownmenu.js"></script>
<script type="text/javascript" src="../../../extension/ezdoc/design/doc/javascripts/ezno-searchbox.js"></script>
                                        
    <title>4.1.x to 4.1.y / Upgrading to 4.1 / Upgrading / eZ Publish / Documentation - Doc</title>

    
    
    
            <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

            <meta http-equiv="Content-language" content="en-GB">

    
                <meta name="author" content="eZ systems">
                    <meta name="copyright" content="eZ systems">
                    <meta name="description" content="eZ Publish Documentation">
                    <meta name="keywords" content="eZ Publish, documentation, manual, reference, eZ systems">
        
    <meta name="generator" content="eZ Publish">
    <link rel="Home" href="https://doc.ez.no/" title="Doc front page">
<link rel="Search" href="https://doc.ez.no/content/advancedsearch" title="Search Doc">
<link rel="Shortcut icon" href="../../../extension/ezdoc/design/doc/images/favicon.ico" type="image/x-icon">

</head>
<body onload="initDocSearch();menuInit();">

<!-- Complete page area: START -->
<div id="page">


<div><a href="https://www.ibexa.co"><img class="logotype" width="100" height="50" src="https://ezpublishdoc.mugo.ca/design/standard/images/ibexa_logo.svg" alt="ibexa"></a></div>
<div id="page-content-position"><div id="page-content-position-inner"><div id="page-content">

<!-- Path area: START -->
<div id="path">

<div id="page-width4">
<h2 class="hide">Path</h2>

<!-- Path content: START -->
<p><a href="../index.html">ez publish</a>
        
                        /
                            <a href="../../Upgrading.html">upgrading</a>
        
                        /
                            <a href="../Upgrading-to-4.1.html">upgrading to 4.1</a>
        
                        /
                            4.1.x to 4.1.y
        
            </p>
<!-- Path content: END -->

</div>

</div>
<!-- Path area: END -->

<hr class="hide">

<!-- Main area: START -->
                                    <div id="ezp5disclaimer">
                <p><strong style="color: red">Caution:</strong> This documentation is for <strong>eZ Publish</strong> <em>legacy</em>, from version 3.x to 5.x.<br></p>
            </div>
            
<div id="page-width5">
<div id="main" class="float-break">


<div class="template-design area-docmenu-normal">
<div class="template-module">
<div class="template-object">
<div id="contentmenu">
                        <div class="attribute-heading"><h2 class="bullet"><a href="../Upgrading-to-4.1.html">Table of contents</a></h2></div>
<div class="boxcontent">

<map id="contentstructure">

    

                                                                        
            <ul>
	    
                                                        
                                    
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Releases.html" title="">
	    	    		                    		    <span class="node-name-normal">Releases</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../How-to-proceed.html" title="">
	    	    		                    		    <span class="node-name-normal">How to proceed</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Backup-and-consistency-checks.html" title="">
	    	    		                    		    <span class="node-name-normal">Backup and consistency checks</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Direct-upgrading.html" title="">
	    	    		                    		    <span class="node-name-normal">Direct upgrading</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-5.1.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 5.1</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-5.0.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 5.0</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-4.7.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 4.7</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-4.6.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 4.6</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-4.5.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 4.5</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-4.4.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 4.4</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-4.3.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 4.3</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-4.2.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 4.2</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter-selected  ">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-4.1.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 4.1</span>
                    			    	    		</a>
			           </div>
        
            <ul>
	    
                                                    
	<li class="currentnode">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="4.1.x-to-4.1.y.html" title="">
	    	    		                    		    <span class="node-name-normal">4.1.x to 4.1.y</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="last">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="4.0.x-to-4.1.y.html" title="">
	    	    		                    		    <span class="node-name-normal">4.0.x to 4.1.y</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                            </ul>
                                        </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-4.0.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 4.0</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-3.10.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 3.10</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-3.9.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 3.9</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-3.8.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 3.8</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-3.7.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 3.7</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-3.6.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 3.6</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-3.5.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 3.5</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-3.4.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 3.4</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-3.3.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 3.3</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-3.2.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 3.2</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-3.1.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 3.1</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-to-3.0.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading to 3.0</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Upgrading-from-3.a.b-to-3.x.y.html" title="">
	    	    		                    		    <span class="node-name-normal">Upgrading from 3.a.b to 3.x.y</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../The-system-upgrade-scripts.html" title="">
	    	    		                    		    <span class="node-name-normal">The system upgrade scripts</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                
                                                    
	<li class="topchapter">
	    <div>
	    
	    

	    
	    
	    
	    			    	    
	    
	    		<a class="nodetext" href="../Notes-about-database-changes.html" title="">
	    	    		                    		    <span class="node-name-normal">Notes about database changes</span>
                    			    	    		</a>
			           </div>
        
                                    </li>
            
                                            </ul>
                        
            
</map>

</div>            
</div>
</div>
</div>
</div>
<div class="area-docmain-normal">
<div class="template-design">
<div class="template-module content-view-full">
<div class="template-object">

<div class="attribute-heading">
<h1>4.1.x to 4.1.y</h1>
</div>

<p>This section describes how to upgrade your existing eZ Publish 4.1.x installation to version 4.1.y. If you are upgrading from a version prior to eZ Publish 4.1.0, refer to the "<a href="4.0.x-to-4.1.y.html" target="_self">Upgrading from 4.0.x to 4.1.y</a>" section for upgrade instructions.</p><p>In order to benefit from the latest bug fixes, you should upgrade directly to the latest stable release in the 4.1 branch (4.1.2 at the time of writing). Refer to the <a href="https://github.com/ezsystems/ezpublish-legacy/tree/master/doc/changelogs/4.1" target="_blank">changelogs</a> and <a href="http://ez.no/developer/security/security_advisories/ez_publish_4_1" target="_blank">security advisories</a> for more information about the issues that were fixed in the latest releases.</p><a name="eztoc102751_0_1" id="eztoc102751_0_1"></a><h3>Important upgrade notes:</h3>
<ul>
<li><div>"updateimagesystem.php" needs to be run before the "dbupdate" scripts, otherwise the tables being upgraded will be removed. </div></li>
</ul>
<p>Please make a backup of your files and your database before proceeding. The procedure for upgrading directly from version 4.1.x to 4.1.y consists of the following steps:</p>
<ol>
<li><div> Check eZ Components version </div></li><li><div> Update distribution files </div></li><li><div> Transfer custom extensions </div></li><li><div> Check updateimagesystem.php </div></li><li><div> Upgrade database </div></li><li><div> Regenerate autoload data for extensions </div></li><li><div> Run system upgrade scripts </div></li><li><div> Run eZ OE update script </div></li><li><div> Clear caches </div></li>
</ol>
<a name="eztoc102751_1" id="eztoc102751_1"></a><h2>Step 1: Check the eZ Components 2008.2.x requirements</h2><p>With eZ Publish 4.1.1 and later, eZ Components 2008.2.2 is the minimum version required. If you installed a previous version with PEAR, please upgrade to version 2008.2.2. For more information about installing eZ Components see also http://ezcomponents.org/docs/install</p><a name="eztoc102751_2" id="eztoc102751_2"></a><h2>Step 2: Updating the distribution files</h2><p>The easiest way to upgrade the distribution files is to unpack eZ Publish 4.1.1 to a separate directory and then copy the directories that contain site-specific files from the existing installation. Make sure that you copy the following directories:</p>
<ul>
<li><div> design/example </div></li><li><div> design/example_admin </div></li><li><div> var </div></li><li><div> settings/siteaccess </div></li><li><div> settings/override </div></li>
</ul>
<p>Replace " <i>example</i>" and " <i>example_admin</i>" with the actual names of your siteaccesses.</p><a name="eztoc102751_3" id="eztoc102751_3"></a><h2>Step 3: Custom extensions</h2><p>If you are using custom extensions, the sub directories inside the "extension" directory will also have to be copied. However, make sure that you do not overwrite any extensions that come with eZ Publish (currently "ezoe", "ezodf"). Note that upgrading the distribution files will overwrite the autoload arrays for extensions. You will need to re-generate the autoload arrays for active extensions late. See below for dedicated upgrade instructions for ez flow and ez webin.</p><p>Note that ezdhtml is now replaced by ezoe, so you should not copy it over.</p><p>For eZ OE 5.0.x, you will need to have the following rewrite rule if using Virtual Hosts:</p><pre class="wordwrap"><span class="line">RewriteRule ^/var/[^/]+/cache/public/.* - [L]</span>
</pre><p>For more detailed instructions, see the dedicated doc page: http://ez.no/doc/extensions/online_editor/5_x/installation</p><a name="eztoc102751_4" id="eztoc102751_4"></a><h2>Step 4: updateimagesystem.php</h2><p>(If your upgrading from 4.1.0 and not directly from 4.0.x) First of all, if you don't have image data from before version 3.3 of eZ Publish, you don't have to do anything, you can skip running the "updateimagesystem.php" script</p><p>If you do have old data or you suspect you might (installation is based on eZ Publish &lt; 3.3), which you want to upgrade, then you have to import the tables ezimage and ezimagevariation from a database backup, as these tables were unfortunately removed in the dbupdate scripts of 4.1.0. After the tables have been restored, the updateimagesystem.php script needs to be run.</p><a name="eztoc102751_5" id="eztoc102751_5"></a><h2>Step 5: Upgrading the database</h2><p>The update script for the database is located in:</p><pre class="wordwrap"><span class="line">&lt;eZP root&gt;/update/database/&lt;mysql|postgresql&gt;/4.1/dbupdate-4.1.x-to-4.1.y.sql</span>
</pre><p>You can run this with the appropriate command line tool or application</p><a name="eztoc102751_6" id="eztoc102751_6"></a><h2>Step 6: Regenerate the autoload array for extensions</h2><p>The autoload system has also some changes, for example the autoload array for extensions is now placed in var/autoload of your eZ Publish installation.</p><p>To regenerate the autoload array, execute the following script:</p><pre class="wordwrap"><span class="line">php bin/php/ezpgenerateautoloads.php --extension</span>
</pre><a name="eztoc102751_7" id="eztoc102751_7"></a><h2>Step 7: Running the system upgrade scripts</h2><p>The update scripts are located in:</p><pre class="wordwrap"><span class="line">&lt;eZP root&gt;/update/common/scripts/4.1</span>
</pre><p>Please note, that if these scripts were executed as part of the initial upgrade in 4.1.0, they do not have to be executed again this time.</p>
<ul>
<li><div> addlockstategroup.php (Used for creating locked states, part of the object states functionality. Updated in 4.1.1) </div></li><li><div> fixclassremoteid.php (Fixing remote IDs of classes. Updated in 4.1.2 for PostgreSQL compatibility.) </div></li><li><div> fixobjectremoteid.php (Fixes non-unique usage of content object remote IDs. Updated in 4.1.2 for PostgreSQL compatibility.) </div></li><li><div> correctxmlalign.php: after upgrading to 4.1 the default alignment for embedded images in ezxmltext datatype was removed, this script will allow you to have the correct xmlalignment. </div></li>
</ul>
<a name="eztoc102751_8" id="eztoc102751_8"></a><h2>Step 8: Run the eZ OE upgrade database script</h2><p>(If you upgrade ezoe from 5.0.0 or earlier beta versions of the 5.0.x version) One of the bugs ( <a href="http://issues.ez.no/14670" target="_self">#14670</a>) fixed in OE 5.0.1 caused object relations to be stored with wrong relation type id, so they where not removed as relation when you removed them from editor area (ezxmltext). In order to fix the problem on existing relations created with OE 5.0.0 (also affected all prior beta- and rc-releases), apply the following:</p><pre class="wordwrap"><span class="line">&lt;eZP root&gt;/extension/ezoe/update/database/5.0/dbupdate-5.0.0-to-5.0.1.sql</span>
</pre><a name="eztoc102751_9" id="eztoc102751_9"></a><h2>Step 9: Clearing the caches</h2><p>Whenever an eZ Publish solution is upgraded, all caches must be cleared in a proper way. This should be done from within a system shell:</p><p>
Navigate into the eZ Publish 4.0.y directory.<br> Run the script using the following shell command:</p><pre class="wordwrap"><span class="line">php bin/php/ezcache.php --clear-all --purge</span>
</pre>

<div class="break"></div><div class="pageinfo float-break">
<div class="created">


<p><label>Written by:</label>Ole Marius Smestad (26/05/2009 2:30 pm)</p>
</div>
<div class="modified">
<p><label>Last updated by:</label>Geir Arne Waaler (01/06/2011 11:11 am)</p>
</div><div class="authors">
<p><label>Maintainers:</label>Ole Marius Smestad, André R., Ester Heylen, Geir Arne Waaler</p>
</div></div>
<hr class="hide">

</div>
</div>
</div>

<div id="comments" class="class-comment">
<div class="content-view-children">

<h1>Comments</h1>
<div id="comments-content">
<ul>    <li class="comment-bglight"><div class="padding">
    <div class="content-view-line">
<div class="class-comment">

<div>

<div id="comment20763" class="attribute-heading">
<h2>Rewrite rule wrong upgrade page?</h2>
</div>

<div class="attribute-byline float-break">
    <p class="date">Friday 11 September 2009 4:01:02 pm</p>
    <p class="author">Kristof Coomans</p>
</div>

<div class="attribute-short">
The rewrite rule that needs to be added, from "Step 3: Custom extensions", doesn't that instruction belong on the 4.0 to 4.1 upgrade page instead of here?
</div>




     


</div>


</div>
</div>    </div></li></ul>
</div>
<div class="toolbar">


</div>

</div>
</div>

</div>
<!-- Main area content: END -->

</div>
</div>
<!-- Main area: END -->
<hr class="hide">

</div></div></div>



</div>
<!-- Complete page area: END -->











</body>
</html><!-- th[eZ] 20050804 -->
